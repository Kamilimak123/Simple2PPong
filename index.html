<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Welcome to Pong Game</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .canvasStyle {
            background: #eee;
            display: block;
            margin: 20px auto;
            border: 1px solid #000000;
            grid-row: 1/3;
            grid-column: 2;
        }

        .container {
            margin: 10px auto;
            text-align: center;
        }

        #movement_button1 {
            grid-column: 1;
            grid-row: 1;
        }

        #movement_button2 {
            grid-column: 1;
            grid-row: 2;
        }

        #movement_button3 {
            grid-column: 3;
            grid-row: 1;
        }

        #movement_button4 {
            grid-column: 3;
            grid-row: 2;
        }

        #leftScore {
            float: left;
            text-align: center;
            font-size: 3rem;
        }

        #rightScore {
            float: right;
            text-align: center;
            font-size: 3rem;
        }

        .grid {
            display: grid;
            margin: 10px auto;
            text-align: center;
            font-size: 3rem;
            width: 1000px;
            height: 650px;
            grid-template-rows: 1fr 1fr;
            grid-template-columns: 50px 1fr 50px;
            grid-gap: 15px;
            overflow: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="item">Pong Game</h2>
    </div>

    <div class="grid">

        <button id="movement_button1" onmousedown="mouseDown(1)" onmouseup="mouseUp(1)">Up</button>
        <button id="movement_button2" onmousedown="mouseDown(2)" onmouseup="mouseUp(2)">Down</button>
        <div class="canvasStyle">
            <span id="leftScore">0</span> <span id="rightScore">0</span>
            <canvas id="myCanvas" width="800" height="600"></canvas>
        </div>

        <button id="movement_button3" onmousedown="mouseDown(3)" onmouseup="mouseUp(3)">Up</button>
        <button id="movement_button4" onmousedown="mouseDown(4)" onmouseup="mouseUp(4)">Down</button>



    </div>

    <script>
        var canvas = document.getElementById("myCanvas");       // obiekt canvas
        var ctx = canvas.getContext("2d");                      // odniesienie do context2D obiektu canvas

        var leftScore = document.getElementById("leftScore");
        var rightScore = document.getElementById("rightScore");
        var ballRadius = 10;                                    // promień piłki
        var x = canvas.width / 2;                               // pozycja startowa X (pozioma) piłki
        var y = canvas.height / 2;                              // pozycja startowa Y (pionowa) piłki
        var dx = 2;                                             // szybkość piłki w osi poziomej
        var dy = -2;                                            // szybkość piłki w osi pionowej
        var velocity = dx * dx + dy * dy;
        var Vel = velocity;
        var gamePause = false;

        var leftPaddleHeight = 100;
        var leftPaddleWidth = 10;
        var leftPaddleY = (canvas.height - leftPaddleHeight) / 2;

        var rightPaddleHeight = 100;
        var rightPaddleWidth = 10;
        var rightPaddleY = (canvas.height - rightPaddleHeight) / 2;

        var WPressed = false;
        var SPressed = false;
        var UpPressed = false;
        var DownPressed = false;

        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        function mouseDown(arg) {
            if (arg === 1) WPressed = true;
            if (arg === 2) SPressed = true;
            if (arg === 3) UpPressed = true;
            if (arg === 4) DownPressed = true;
        }

        function mouseUp(arg) {
            if (arg === 1) WPressed = false;
            if (arg === 2) SPressed = false;
            if (arg === 3) UpPressed = false;
            if (arg === 4) DownPressed = false;
        }

        function keyDownHandler(e) {
            if (e.key == "Up" || e.key == "ArrowUp") {
                UpPressed = true;
            }
            else if (e.key == "Down" || e.key == "ArrowDown") {
                DownPressed = true;
            }
            if (e.key == "w") {
                WPressed = true;
            }
            else if (e.key == "s") {
                SPressed = true;
            }
            if (!gamePause) {
                if (e.key == "p") {
                    alert("Pause");
                    gamePause = true;
                }
            }

        }

        function keyUpHandler(e) {
            if (e.key == "Up" || e.key == "ArrowUp") {
                UpPressed = false;
            }
            else if (e.key == "Down" || e.key == "ArrowDown") {
                DownPressed = false;
            }
            if (e.key == "w") {
                WPressed = false;
            }
            else if (e.key == "s") {
                SPressed = false;
            }
            if (e.key == "p") {
                gamePause = false;
            }
        }

        function movePaddles() {
            if (DownPressed && rightPaddleY < canvas.height - rightPaddleHeight) {
                rightPaddleY += 5;
            }
            else if (UpPressed && rightPaddleY > 0) {
                rightPaddleY -= 5;
            }
            if (SPressed && leftPaddleY < canvas.height - leftPaddleHeight) {
                leftPaddleY += 5;
            }
            else if (WPressed && leftPaddleY > 0) {
                leftPaddleY -= 5;
            }
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }

        function drawPaddles() {
            ctx.beginPath();
            ctx.rect(0, leftPaddleY, leftPaddleWidth, leftPaddleHeight);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            ctx.arc(5, leftPaddleY + leftPaddleHeight / 2, 5, 0, Math.PI * 2);
            ctx.fillStyle = "#FF0000";
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            ctx.rect(canvas.width - 10, rightPaddleY, rightPaddleWidth, rightPaddleHeight);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            ctx.arc(canvas.width - 5, rightPaddleY + rightPaddleHeight / 2, 5, 0, Math.PI * 2);
            ctx.fillStyle = "#FF0000";
            ctx.fill();
            ctx.closePath();
        }

        function checkWalls() {
            if (x + dx > canvas.width - ballRadius) {
                if (y > rightPaddleY - ballRadius && y < rightPaddleY + rightPaddleHeight + ballRadius) {

                    calcHit("right");

                } else {
                    scoreCheck(leftScore);
                }

            }
            if (x + dx < ballRadius) {
                if (y > leftPaddleY - ballRadius && y < leftPaddleY + leftPaddleHeight + ballRadius) {

                    calcHit("left");

                } else {
                    scoreCheck(rightScore);
                }

            }
            if (y + dy > canvas.height - ballRadius || y + dy < ballRadius) {
                dy = -dy;
            }
        }

        function calcHit(hitter) {
            if (hitter == "left") {
                dy = (y - leftPaddleY) / ((leftPaddleHeight + 2 * ballRadius) / 4) - 2;
            }
            if (hitter == "right") {
                dy = (y - rightPaddleY) / ((rightPaddleHeight + 2 * ballRadius) / 4) - 2;
            }

            dx = Math.sqrt(velocity - (dy * dy));
            if (isNaN(dx)) { dx = 1; }

            if (hitter == "left") {
                if (dx < 0) { dx = -dx; }
            }
            if (hitter == "right") {
                if (dx > 0) { dx = -dx; }
            }

            velocity = velocity + 2;
        }

        function scoreCheck(scorer) {
            x = canvas.width / 2;
            y = canvas.height / 2;
            dx = 0;
            dy = 0;
            velocity = Vel;
            if (scorer == leftScore) {
                leftScore.innerHTML = parseInt(leftScore.innerHTML) + 1;
                leftPaddleHeight = leftPaddleHeight - 10;
                setTimeout(function () { dx = -2; dy = 0 }, 2000);
            }
            if (scorer == rightScore) {
                rightScore.innerHTML = parseInt(rightScore.innerHTML) + 1;
                rightPaddleHeight = rightPaddleHeight - 10;
                setTimeout(function () { dx = 2; dy = 0 }, 2000);
            }
        }


        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBall();
            drawPaddles();
            checkWalls();
            movePaddles();


            if (rightPaddleHeight == 0) {
                window.clearInterval(gameLoop);
                alert("Right Wins!!!")
            }
            if (leftPaddleHeight == 0) {
                window.clearInterval(gameLoop);
                alert("Left Wins!!!")
            }


            x += dx;
            y += dy;
        }
        setTimeout(function () { alert("Enjoy the game :)"); }, 50);
        var gameLoop = setInterval(draw, 10);

    </script>

</body>

</html>
